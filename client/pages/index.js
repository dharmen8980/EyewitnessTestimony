import Head from 'next/head'
import { useState } from 'react';
import Questions from './questions'
import Intro from './intro';
import Sample from './sample';
import EndOfSample from './endOfSample';

export default function Home() {

  const initialResponse = {
    "name": "",
    "cwid": "",
    "race": "",
    "q1": "no",
    "q2": "no",
    "q3": "no",
    "q4": "no",
    "q5": "no",
    "q6": "no",
    "q7": "no",
    "q8": "no",
  };

  const [response, onResponseChange] = useState(initialResponse);
  const [started, onStart] = useState(false);
  const [showSample, setShowSample] = useState(false);

  const handleNameChange = (event) => {
    onResponseChange({ ...response, "name": event.target.value });
  }

  const handleCWIDChange = (event) => {
    onResponseChange({ ...response, "cwid": event.target.value });
  }

  const handleRaceChange = (event) => {
    onResponseChange({ ...response, 'race': event.target.value });
  }

  const onQuestionReponse = (questionId, value) => {
    onResponseChange({ ...response, [questionId]: value });
  }

  const onComplete = () => {
    fetch("http://10.0.0.53:8080", {
      method: "POST",
      body: JSON.stringify(response),
      headers: { "Content-Type": "application/json" }
    })
      .then(response => response.text())
      .then(data => {
        console.log(data);
        globalThis.location = '/last';
      })
      .catch(err => console.error(err));
    console.log("completed");
  }
  return !started ? ( showSample ? (<Sample started={started} onStart={onStart}/>) : (
    <div>
      <div>
        <Head>
          <title>Eyewitness</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>
      </div>
      <Intro/>
      <div className="w-fit mx-auto mb-8">
            <button className="bg-yellow-500 px-2 py-1 rounded-md text-md hover:bg-yellow-600"
            onClick={() => setShowSample(true)}>
              Continue
            </button>
      </div>
    </div>
  )) : (<Questions onQuestionResponse={onQuestionReponse} onComplete={onComplete} />);
}

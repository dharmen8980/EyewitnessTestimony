import Head from 'next/head'
import Link from 'next/link'
import { useState } from 'react';
import Questions from './questions'

export default function Home() {

  const initialResponse = {
    "name": "",
    "cwid": "",
    "race": "",
    "q1": "no",
    "q2": "no",
    "q3": "no",
    "q4": "no",
    "q5": "no",
    "q6": "no",
    "q7": "no",
    "q8": "no",
  };

  const [response, onResponseChange] = useState(initialResponse);
  const [started, onStart] = useState(false);

  const handleNameChange = (event) => {
    onResponseChange({ ...response, "name": event.target.value });
  }

  const handleCWIDChange = (event) => {
    onResponseChange({ ...response, "cwid": event.target.value });
  }

  const handleRaceChange = (event) => {
    onResponseChange({ ...response, 'race': event.target.value });
  }

  const onQuestionReponse = (questionId, value) => {
    onResponseChange({ ...response, [questionId]: value });
  }

  const onComplete = () => {
    fetch("http://192.168.0.119:8080", {
      method: "POST",
      body: JSON.stringify(response),
      headers: { "Content-Type": "application/json" }
    })
      .then(response => response.text())
      .then(data => {
        console.log(data);
        globalThis.location = '/last';
      })
      .catch(err => console.error(err));

    console.log("completed");
  }

  return !started ? (
    <div>
      <div>
        <Head>
          <title>Virtual Hut</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>
      </div>
      <div className='text-3xl text-white bg-red relative top-10'>
        <div>
          <div className='flex flex-col flex-auto justify-center items-center'>
            <p className='text-center px-10 mx-20'>
              Welcome to Eyewitness testimony survey!<br />
              In this survey you will be presented with videos and pictures
              of individuals from same ethinicity and similar appearance.
              Throughout the survey you have to answer yes or no, if you think
              the individual are same or not.
            </p>
            <p className='my-5 font-semibold text-yellow-400 text-4xl'>
              Enter you information below and hit start to begin the survey!
            </p>
          </div>
          <div className='text-white grid grid-cols-2 w-fit place-items-end gap-3 my-4'>
            <div className='text-white'>
              <p className='my-3' >Name: </p>
              <p className='my-3'>CWID: </p>
              <p className='my-3'>Race: </p>
            </div>
            <div className='col-spans-2 text-black'>
              <p className='my-3' ><input name="name" type="text" className='w-[420px] text-md' onChange={handleNameChange} /></p>
              <p className='my-3'><input name="cwid" type="number" className='w-[420px]' onChange={handleCWIDChange} /></p>
              <p className='my-3'><input name="race" type="text" className='w-[420px]' onChange={handleRaceChange} /> </p>
            </div>
          </div>
        </div>
      </div>
      <div className='w-fit mx-auto'>
        <button className="realtive mt-20 content-center text-white" onClick={() => onStart(true)}>
          {/* <Link href='questions' passHref className='font-extrabold text-3xl text-white bg-blue-600 px-5 py-2 rounded-md'> */}
          Start
          {/* </Link> */}
        </button>
      </div>
    </div>
  ) : (<Questions onQuestionResponse={onQuestionReponse} onComplete={onComplete} />);
}
